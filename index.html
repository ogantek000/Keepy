<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Passy</title>

  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: #0f172a;
      color: white;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      font-size: 20px;
      font-weight: bold;
    }
    .add {
      font-size: 28px;
      cursor: pointer;
    }
    .list {
      padding: 16px;
      display: grid;
      gap: 12px;
    }
    .card {
      background: #020617;
      padding: 16px;
      border-radius: 14px;
    }
    .top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .streak {
      font-size: 36px;
      margin: 8px 0;
    }
    button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      background: #22c55e;
      margin-top: 8px;
    }
    .delete {
      background: transparent;
      color: #ef4444;
      font-size: 18px;
      width: auto;
    }
  </style>
</head>
<body>

<header>
  <span>Twoje passy</span>
  <span class="add" id="addBtn">ï¼‹</span>
</header>

<div class="list" id="list"></div>

<script>
  const listEl = document.getElementById("list");
  const addBtn = document.getElementById("addBtn");

  const today = () => new Date().toISOString().slice(0, 10);
  const load = () => JSON.parse(localStorage.getItem("habits")) || [];
  const save = (h) => localStorage.setItem("habits", JSON.stringify(h));

  let habits = load();

  function daysBetween(a, b) {
    return Math.floor((new Date(a) - new Date(b)) / 86400000);
  }

  function refresh() {
    listEl.innerHTML = "";

    habits.forEach(habit => {
      if (habit.lastDate) {
        const diff = daysBetween(today(), habit.lastDate);
        if (diff > 1) habit.streak = 0;
      }

      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <div class="top">
          <strong>${habit.name}</strong>
          <button class="delete">ðŸ—‘</button>
        </div>
        <div class="streak">ðŸ”¥ ${habit.streak}</div>
        <button>Zrobione dziÅ›</button>
      `;

      const doneBtn = card.querySelector("button");
      const deleteBtn = card.querySelector(".delete");

      doneBtn.onclick = () => {
        if (habit.lastDate === today()) return;

        if (habit.lastDate && daysBetween(today(), habit.lastDate) === 1) {
          habit.streak++;
        } else {
          habit.streak = 1;
        }

        habit.lastDate = today();
        save(habits);
        refresh();
      };

      deleteBtn.onclick = () => {
        habits = habits.filter(h => h.id !== habit.id);
        save(habits);
        refresh();
      };

      listEl.appendChild(card);
    });

    save(habits);
  }

  addBtn.onclick = () => {
    const name = prompt("Nazwa nowej passy:");
    if (!name) return;

    habits.push({
      id: Date.now(),
      name,
      streak: 0,
      lastDate: null
    });

    save(habits);
    refresh();
  };

  refresh();
</script>

</body>
</html>

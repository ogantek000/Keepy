<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keepy â€“ Keep Going</title>
<link rel="icon" href="icon.png">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
  background:#0f172a;
  color:white;
  margin:0;
  padding:16px;
}

.header { text-align:center; margin-bottom:16px; }
.mascot { width:220px; height:220px; border-radius:50%; object-fit:cover; }
h1 { margin:8px 0 4px; font-size:28px; color:#3b82f6; }
.motto { font-size:14px; color:#94a3b8; margin-bottom:8px; }

.add {
  position:fixed; bottom:24px; right:24px;
  width:56px; height:56px; border-radius:50%;
  background:#22c55e; color:black;
  font-size:32px; border:none; font-weight:bold;
}

.habit {
  background:rgba(255,255,255,0.05);
  padding:16px; border-radius:14px;
  margin-bottom:12px;
  opacity:0; transform:translateY(20px);
  transition:0.25s;
  position:relative;
}

.habit.show { opacity:1; transform:none; }

.habit.ice::after{
  content:""; position:absolute; inset:0;
  background:#3b82f6; opacity:0;
  border-radius:14px;
  animation:ice 0.8s;
}
@keyframes ice{
  30%,60%{opacity:.6;} 100%{opacity:0;}
}

.habit-header{
  display:flex; justify-content:space-between;
  align-items:center;
}

.name { font-size:18px; }
.streak { font-size:20px; color:#ff9500; }

.actions button{
  margin-left:6px;
  padding:6px 10px;
  border:none; border-radius:8px;
}

.done{background:#22c55e;}
.freeze{background:#facc15;}
.delete{background:#ef4444;color:white;}

.toggle-cal, .edit-cal{
  margin-top:8px;
  width:100%;
  padding:8px;
  border:none;
  border-radius:8px;
  background:#3b82f6;
  color:white;
}

.edit-cal.active{ background:#f97316; }

.calendar{
  display:flex; flex-wrap:wrap;
  max-height:0; overflow:hidden;
  opacity:0;
  transition:0.3s;
  pointer-events:none;
}

.calendar.show{
  max-height:400px;
  opacity:1;
}

.calendar.editing{
  pointer-events:auto;
  outline:2px dashed #f97316;
}

.calendar-header{
  width:100%;
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
}

.day{
  width:14.2%;
  height:28px;
  margin-bottom:2px;
  text-align:center;
  line-height:28px;
  font-size:12px;
  border-radius:6px;
  background:#111827;
}

.calendar.editing .day{
  cursor:pointer;
}

.day.done{ background:#22c55e; color:black;}
.day.freeze{ background:#facc15; color:black;}
.day.missed{ background:#ef4444; }

</style>
</head>
<body>

<div class="header">
  <img src="bro.jpg" class="mascot">
  <h1>Keepy</h1>
  <p class="motto">Keep Going</p>
</div>

<div id="list"></div>
<button class="add" id="addBtn">+</button>

<script>
const list=document.getElementById("list");
const addBtn=document.getElementById("addBtn");
const today=()=>new Date().toISOString().slice(0,10);

let habits=JSON.parse(localStorage.getItem("keepy"))||[];

const save=()=>localStorage.setItem("keepy",JSON.stringify(habits));

function renderCalendar(h){
  const wrap=document.createElement("div");
  const cal=document.createElement("div");
  cal.className="calendar";

  const header=document.createElement("div");
  header.className="calendar-header";

  const title=document.createElement("span");
  title.textContent=new Date().toLocaleString("pl-PL",{month:"long",year:"numeric"});
  header.appendChild(title);
  wrap.appendChild(header);

  const first=(new Date().getDay()+6)%7;
  const days=new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate();

  for(let i=0;i<first;i++){
    cal.appendChild(document.createElement("div"));
  }

  for(let d=1;d<=days;d++){
    const dayStr=`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const div=document.createElement("div");
    div.className="day";
    div.textContent=d;

    if(h.datesDone.includes(dayStr)) div.classList.add("done");
    else if(h.freezeDates.includes(dayStr)) div.classList.add("freeze");

    div.onclick=()=>{
      if(!cal.classList.contains("editing")) return;
      if(h.freeze && dayStr===today()) return;

      if(h.datesDone.includes(dayStr)){
        h.datesDone=h.datesDone.filter(x=>x!==dayStr);
        h.freezeDates.push(dayStr);
      }else if(h.freezeDates.includes(dayStr)){
        h.freezeDates=h.freezeDates.filter(x=>x!==dayStr);
      }else{
        h.datesDone.push(dayStr);
      }
      save(); render();
    };

    cal.appendChild(div);
  }

  wrap.appendChild(cal);
  return {wrap,cal};
}

function render(){
  list.innerHTML="";
  habits.forEach((h,i)=>{
    const div=document.createElement("div");
    div.className="habit";

    div.innerHTML=`
      <div class="habit-header">
        <div>
          <div class="name">${h.name}</div>
          <div class="streak">ðŸ”¥ ${h.streak}</div>
        </div>
        <div class="actions">
          <button class="done">Zrobione dziÅ›</button>
          <button class="freeze">Freeze</button>
          <button class="delete">âœ•</button>
        </div>
      </div>
    `;

    const toggle=document.createElement("button");
    toggle.className="toggle-cal";
    toggle.textContent="ðŸ“… PokaÅ¼ kalendarz";

    const edit=document.createElement("button");
    edit.className="edit-cal";
    edit.textContent="âœï¸ Edytuj historiÄ™";

    const {wrap,cal}=renderCalendar(h);

    toggle.onclick=()=>{
      cal.classList.toggle("show");
      toggle.textContent=cal.classList.contains("show")?"Ukryj kalendarz":"ðŸ“… PokaÅ¼ kalendarz";
    };

    edit.onclick=()=>{
      cal.classList.toggle("editing");
      edit.classList.toggle("active");
      edit.textContent=cal.classList.contains("editing")
        ?"âœ”ï¸ ZakoÅ„cz edycjÄ™"
        :"âœï¸ Edytuj historiÄ™";
    };

    div.querySelector(".done").onclick=()=>{
      if(h.freeze) return;
      if(!h.datesDone.includes(today())){
        h.datesDone.push(today());
        h.streak++;
        save(); render();
      }
    };

    div.querySelector(".freeze").onclick=()=>{
      h.freeze=!h.freeze;
      h.freezeDates.push(today());
      div.classList.add("ice");
      setTimeout(()=>div.classList.remove("ice"),800);
      save(); render();
    };

    div.querySelector(".delete").onclick=()=>{
      if(confirm("UsunÄ…Ä‡ passÄ™?")){
        habits.splice(i,1); save(); render();
      }
    };

    div.append(toggle,edit,wrap);
    list.appendChild(div);
    setTimeout(()=>div.classList.add("show"),10);
  });
}

addBtn.onclick=()=>{
  const n=prompt("Nazwa passy:");
  if(n){
    habits.push({
      name:n,
      streak:0,
      datesDone:[],
      freezeDates:[],
      freeze:false
    });
    save(); render();
  }
};

render();
</script>
</body>
</html>
